<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="wallet style.css">
  <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>


  <title>ุงููุญูุธุฉ ุงูุฅููุชุฑูููุฉ ููููุงุทู</title>

</head>
<body>
  <div class="container">
    <aside class="sidebar">
        <div class="sidebar-header">
          <p style="text-align: center;">Hello, <span class="admin" id="adminName2">Admin</span> ๐</p><br>
          <i class="fas fa-user user-icon"></i>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="#" data-section="home"><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</a></li>
                <li><a href="#" data-section="documents"><i class="fas fa-file-alt"></i>  ูุซุงุฆู</a></li>
                <li><a href="#" data-section="trackdocuments"><i class="fas fa-search"></i> ุชุชุจุน ูุซุงุฆู</a></li>
                <li><a href="#" data-section="settings"><i class="fas fa-cog"></i> ุฅุนุฏุงุฏุงุช</a></li>
               <li><a  onclick="logOut()"><i class="fas fa-sign-out-alt"></i> ุชุณุฌูู ุฎุฑูุฌ</a></li>

            </ul>
        </nav>
    </aside>

    <main class="main-content">
      <div class="mobile-user-info">
        <i class=" user-icon"><img width="20px" src="image.png"></i>
          <p style="text-align: center;">ูุฑุญุจูุงุ๐ <span  id="adminName">Admin</span> </p><br>
      </div>
        <div id="content">
          <!-- Content will be rendered here -->
        </div>
    </main>
</div>
<nav class="bottom-nav">
    <ul>
        <li><a href="#" data-section="documents"><i class="fas fa-file-alt"></i><span> </span></a></li>
        <li><a href="#" data-section="trackdocuments"><i class="fas fa-search"></i><span> </span></a></li>
        <li><a style="background-color: #4154f1; border-radius: 45px; color: #ececec;" href="#" data-section="home"><i class="fas fa-home"></i><span></span></a></li>
        <li><a href="#" data-section="settings"><i class="fas fa-cog"></i><span></span></a></li>
        <li><a  onclick="logOut()"><i class="fas fa-sign-out-alt"></i> </a></li>
    </ul>
</nav>

<!-- ูุงูุฐุฉ ูุณุญ QR -->
<div id="qrScannerPopup" class="popup" style="display: none;">
  <div class="popup-content">
    <span class="close-btn" id="closeQrScanner">&times;</span>
    <h3>ูุณุญ QR</h3>
    <div id="qrScanner"></div> <!-- ููุง ุณูุชู ุนุฑุถ ุงููุงููุฑุง -->
  </div>
</div>
<div id="cameraPermissionInstructions" class="permission-instructions" style="display: none;">
  <h4>ุชูููู ุงููุงููุฑุง</h4>
  <ol>
    <li>ุงููุฑ ุนูู ุฃููููุฉ ุงูููู/ุงููุงููุฑุง ูู ุดุฑูุท ุงูุนููุงู</li>
    <li>ุงุฎุชุฑ "ุงูุณูุงุญ" ูููุงููุฑุง</li>
    <li>ูู ุจุชุญุฏูุซ ุงูุตูุญุฉ ูุญุงูู ูุฑุฉ ุฃุฎุฑู</li>
  </ol>
</div>
<script src="script.js"></script>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
<script>
  function    logOut() {
      localStorage.removeItem('token');
      localStorage.removeItem('userId');
      window.location.href = 'login-admin.html';
    }
  window.onload = () => {
  function checkAuth() {
    const token = localStorage.getItem('token');

    if (!token) {
      window.location.href = 'login-admin.html'; // ุฅุนุงุฏุฉ ุงูุชูุฌูู ุฅุฐุง ูู ููู ููุงู ุชููู
      return;
    }

    try {
      // ูู ุงูุชููู ูุงูุชุญูู ูู ุงูุฏูุฑ
      const decoded = jwt_decode(token);
      if (decoded.role !== 'citizen') {
        window.location.href = 'dashboard.html'; // ุฅุนุงุฏุฉ ุงูุชูุฌูู ุฅูู ูุญูุธุฉ ุงูููุงุทู ุฅุฐุง ูู ููู "admin"
      }
         // ุงุณุชุฎุฑุงุฌ ุงุณู ุงููุณุคูู ูู ุงูุชููู ูุนุฑุถู
         const adminName = decoded.fullName ;
         document.getElementById('adminName').textContent = adminName;
         document.getElementById('adminName2').textContent = adminName;

    } catch (error) {
      console.error('ุฎุทุฃ ูู ูู ุงูุชููู:', error);
      localStorage.removeItem('token');
      localStorage.removeItem('userId');
      window.location.href = 'login-admin.html'; // ุฅุนุงุฏุฉ ุงูุชูุฌูู ุฅุฐุง ูุงู ููุงู ุฎุทุฃ ูู ุงูุชููู
    }
  }
  checkAuth();
  setInterval(checkAuth, 3000);
};
window.addEventListener("storage", (event) => {
    if (event.key === "token" && !event.newValue) {
      window.location.href = "login-admin.html"; // ุฅุนุงุฏุฉ ุงูุชูุฌูู ุฅุฐุง ุชู ุญุฐู ุงูุชููู
    }
  });
</script>
</body>
</html>
